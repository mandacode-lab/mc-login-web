name: Release

on:
  push:
    tags:
      - "v*"
  workflow_dispatch:

permissions:
  contents: read
  id-token: write

jobs:
  docker-build-ecr:
    name: Build and Push Docker Images to ECR
    uses: mandacode-lab/workflows/.github/workflows/docker-build-ecr.yml@v0.2.1
    with:
      images: |
        [
          {"dockerfile": "Dockerfile"}
        ]
      base-path: "build"
      aws-region: ${{ vars.AWS_REGION }}
      ecr-registry: ${{ vars.REGISTRY }}
      ecr-repository-prefix: ${{ vars.REPOSITORY }}
      tag: ${{ github.ref_name }}
      tag-prefix: "v"
      platforms: "linux/amd64"
      create-repository: true
    secrets:
      # Option 1: OIDC (Recommended)
      aws-role-arn: ${{ secrets.AWS_ROLE_ARN }}

      # Option 2: Access Keys (comment out if using OIDC)
      # aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
      # aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
